# Copyright 2020-present Open Networking Foundation
# SPDX-License-Identifier: LicenseRef-ONF-Member-1.0

name: Component test

on:
  pull_request:
    branches: [ master ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - name: Build the Docker images
        run: docker-compose build
      - name: Run demo test
        run: |
          # Run demo for 10s and check results
          docker-compose up -d
          sleep 12
      - name: Check results
        run: |
          docker-compose logs --tail 10 dbuf-client
          docker-compose logs --tail 10 dbuf-client | grep "Demo was a success!"
          # 4 flows generating notifications at 3s intervals for 10s = 16 notifications
          docker-compose logs dbuf-client | grep "Notification first_buffer:"
          docker-compose logs dbuf-client | grep "Notification first_buffer:" | wc -l | grep 16
